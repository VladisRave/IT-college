# Основные этапы проектирования баз данных

Проектирование базы данных — это процесс создания структуры, обеспечивающей корректное, эффективное и надёжное хранение, обработку и извлечение данных в соответствии с требованиями приложения или системы.

Проектирование БД осуществляется поэтапно и включает три основные фазы:  
1. Концептуальное проектирование  
2. Логическое проектирование  
3. Физическое проектирование  

Каждая фаза имеет свои цели, выходные документы и методы моделирования.

---

## 1. Концептуальное проектирование

Цель: Создание абстрактной, независимой от СУБД и технологий модели данных, отражающей предметную область.

### Основные задачи:
- Выявление сущностей предметной области.
- Определение атрибутов сущностей.
- Установление связей между сущностями.
- Формализация бизнес-правил и ограничений.

### Инструмент моделирования:
- **ER-диаграмма** (Entity-Relationship Diagram) — графическое представление сущностей, атрибутов и отношений.

### Элементы ER-модели:
- **Сущность (Entity)** — объект реального мира, о котором хранится информация.  
  Пример: `Студент`, `Курс`, `Заказ`.
- **Атрибут (Attribute)** — характеристика сущности.  
  Пример: `id`, `имя`, `дата_рождения`, `номер_заказа`.
- **Ключ (Key)** — атрибут или группа атрибутов, однозначно идентифицирующая экземпляр сущности.  
  Пример: `id` студента — первичный ключ.
- **Отношение (Relationship)** — связь между двумя или более сущностями.  
  Пример: `Студент` записывается на `Курс`.
- **Кардинальность отношения** — количество экземпляров одной сущности, связанное с экземпляром другой:  
  - 1:1 (один к одному)  
  - 1:N (один ко многим)  
  - M:N (многие ко многим)

### Результат этапа:
- ER-диаграмма предметной области.  
- Словарь данных (описание всех сущностей, атрибутов, типов, доменов, ограничений).

### Особенности:
- Не привязана к конкретной СУБД.  
- Использует естественный язык и визуальные средства.  
- Обсуждается с заказчиком и предметными экспертами.

---

## 2. Логическое проектирование

Цель: Преобразование концептуальной модели в структуру, совместимую с выбранной моделью данных (реляционной, иерархической, сетевой), с учётом нормализации.

### Основные задачи:
- Преобразование ER-диаграммы в реляционную модель.
- Нормализация таблиц для устранения избыточности и аномалий.
- Определение первичных и внешних ключей.
- Формирование схемы базы данных в виде набора отношений (таблиц).

### Преобразование ER-элементов в реляционную модель:

| ER-элемент | Реляционная реализация |
|------------|------------------------|
| Сущность | Таблица |
| Атрибут | Поле (столбец) таблицы |
| Первичный ключ | Поле с ограничением PRIMARY KEY |
| Отношение 1:N | Внешний ключ в таблице «много» |
| Отношение M:N | Отдельная связывающая таблица (ассоциативная сущность) |
| Отношение 1:1 | Внешний ключ в одной из таблиц (по выбору) |

### Пример преобразования:
**ER-отношение:**  
`Студент` (1) — (N) `Запись на курс`  
→ Создаётся таблица `Запись_на_курс` с полями:  
- `student_id` (внешний ключ к `Студент`)  
- `course_id` (внешний ключ к `Курс`)  
- `дата_записи`

### Нормализация
Нормализация — процесс разбиения таблиц на более мелкие с целью устранения избыточности и аномалий вставки, удаления и обновления.

#### Первая нормальная форма (1НФ)
- Каждый атрибут содержит только атомарные значения.  
- Нет повторяющихся групп.  
- Каждая строка уникальна.

#### Вторая нормальная форма (2НФ)
- Таблица находится в 1НФ.  
- Все неключевые атрибуты полностью зависят от всего первичного ключа (не от его части).  
- Применяется к таблицам с составным ключом.

#### Третья нормальная форма (3НФ)
- Таблица находится в 2НФ.  
- Никакой неключевой атрибут не зависит от другого неключевого атрибута (нет транзитивной зависимости).

> **Примечание:** В практических проектах часто допускается денормализация для повышения производительности, но только после анализа и обоснования.

### Результат этапа:
- Логическая схема базы данных в виде списка таблиц.  
- Для каждой таблицы:  
  - Имя  
  - Список полей с типами данных  
  - Первичные ключи  
  - Внешние ключи  
  - Ограничения (NOT NULL, UNIQUE, CHECK)  
- Документация с описанием нормализационных преобразований.

---

## 3. Физическое проектирование

Цель: Реализация логической модели в конкретной СУБД с учётом аппаратных и программных ограничений, требований к производительности и безопасности.

### Основные задачи:
- Выбор СУБД (MySQL, PostgreSQL, SQL Server и т.д.).
- Определение типов данных с учётом ограничений СУБД.
- Назначение индексов для ускорения запросов.
- Разработка стратегии хранения и разделения данных (файлы, табличные пространства).
- Настройка ограничений целостности, триггеров, представлений.
- Планирование резервного копирования и восстановления.
- Распределение данных по физическим устройствам (если требуется).

### Ключевые решения:
- **Типы данных:**  
  `VARCHAR(255)` vs `TEXT`, `INT` vs `BIGINT`, `DATE` vs `DATETIME`.  
- **Индексы:**  
  Создаются на столбцах, используемых в WHERE, JOIN, ORDER BY.  
  Избыточные индексы замедляют операции INSERT/UPDATE/DELETE.  
- **Представления (VIEW):**  
  Виртуальные таблицы для упрощения сложных запросов.  
- **Триггеры:**  
  Автоматические действия при изменении данных (логирование, валидация).  
- **Разделение данных:**  
  Архивация старых данных, шардинг, партиционирование.

### Результат этапа:
- Физическая схема базы данных:  
  - SQL-скрипты создания таблиц, индексов, ограничений.  
  - Описание параметров хранения (размеры, расположение файлов).  
  - Документация по производительности, безопасности, резервному копированию.  
- Готовый к реализации DDL-код (Data Definition Language).

---

## Общие принципы проектирования БД

- **Целостность данных** — обеспечение корректности и согласованности информации.  
- **Нормализация** — минимизация избыточности.  
- **Производительность** — оптимизация доступа к данным через индексы и структуру запросов.  
- **Масштабируемость** — возможность увеличения объёма данных без перестройки схемы.  
- **Безопасность** — управление правами доступа, шифрование, аудит.  
- **Поддерживаемость** — читаемость схемы, наличие документации.

---

## Последовательность этапов проектирования БД

1. **Анализ предметной области** — сбор требований, выявление сущностей.  
2. **Концептуальное проектирование** — создание ER-модели.  
3. **Логическое проектирование** — преобразование в реляционную модель, нормализация.  
4. **Физическое проектирование** — реализация в СУБД, настройка производительности.  
5. **Тестирование и оптимизация** — проверка на соответствие требованиям, анализ производительности.  
6. **Документирование** — оформление всех этапов и схем.

> **Важно:** Процесс не является строго линейным. Часто возвращаются к предыдущим этапам при обнаружении ошибок или новых требований.

---

## Критерии качества проектированной БД

| Критерий | Описание |
|----------|----------|
| Корректность | Данные соответствуют реальному миру и бизнес-правилам. |
| Полнота | Все необходимые данные хранятся и доступны. |
| Минимальная избыточность | Нет дублирования информации. |
| Согласованность | Внешние ключи обеспечивают целостность связей. |
| Эффективность | Запросы выполняются быстро, используются индексы. |
| Безопасность | Доступ контролируется, данные защищены. |
| Поддерживаемость | Схема понятна, задокументирована, легко изменяется. |